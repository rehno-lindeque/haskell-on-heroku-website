<!doctype html>
<html class="no-transition add-section-toc"data-max-section-toc-level="1" lang="en">
<head>
<meta charset="utf-8">
<title>Haskell on Heroku — Documentation</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes,minimal-ui">
<base href="http://haskellonheroku.com/">
<link rel="canonical" href="http://haskellonheroku.com/documentation/">
<link rel="icon" type="image/png" href="_images/favicon-48.png" sizes="48x48">
<link rel="icon" type="image/png" href="_images/favicon-16.png" sizes="16x16">
<link rel="icon" type="image/png" href="_images/favicon-32.png" sizes="32x32">
<link rel="stylesheet" href="_stylesheets.css.gz">

<style>
  header a.link-documentation {
    color: #ac5cf0;
  }
</style>
</head>
<body>
<header id="top">
<div class="wrapper">
<nav id="header-menu-bar" class="menu-bar">
<h1 class="logotype"><a href="." title="Haskell on Heroku">Haskell on Heroku</a></h1>
<span id="header-button" class="menu-button"><a href="" title="Menu">Menu</a></span>
<ul id="header-menu" class="menu">
<li><a class="link-about" href="about/">About</a></li> <li><a class="link-documentation" href="documentation/">Documentation</a></li> <li><a href="https://github.com/mietek/haskell-on-heroku/">GitHub</a></li>
</ul>
<script>
if (localStorage['header-menu-open']) {
  document.getElementById('header-menu-bar').classList.add('open');
  document.getElementById('header-menu').classList.add('open');
  document.getElementById('header-button').classList.add('open');
}
</script>
</nav>


</div>
</header>

<main id="more">
<div class="wrapper">
<section id="documentation" class="level1">
<h1>Documentation</h1>
<p><em>Haskell on Heroku</em> user guide.</p>
<p>Detailed technical information is available in the <a href="documentation/reference/"><em>Haskell on Heroku</em> reference</a>.</p>
<p>Work in progress. Please report any problems with the documentation on the <a href="https://github.com/mietek/haskell-on-heroku-website/issues/"><em>haskell-on-heroku-website</em> issue tracker</a>.</p>
<blockquote>
<p>Contents:</p>
</blockquote>
<section id="packages" class="level2">
<h2>Packages</h2>
<p><em>Haskell on Heroku</em> uses prebuilt packages to speed up deployment.</p>
<p>Please be mindful of the many meanings of the term <em>package</em>. In this documentation, the term <em>package</em> always means <em>prebuilt package</em>, and refers to one of the four following types of entities:</p>
<ol type="1">
<li><p><em>GHC packages</em>, which contain a live installation of GHC, including the default global GHC database. The user GHC database is always empty.</p></li>
<li><p><em>Cabal packages</em>, in two flavours:</p>
<ul>
<li><p><em>Non-updated Cabal packages</em>, containing only the <code>cabal-install</code> executable and configuration file.</p></li>
<li><p><em>Updated Cabal packages</em>, containing also an updated Cabal database.</p></li>
</ul></li>
<li><p><em>Sandbox packages</em>, which contain a live sandbox, including all dependencies required to compile a specific app.</p></li>
<li><p><em>App packages</em>, which contain a live app, including all intermediate files in its <code>dist</code> directory.</p></li>
</ol>
<p>All packages include a <code>tag</code> file in their top-level directory, declaring the contents of the package.</p>
<section id="naming" class="level3">
<h3>Naming</h3>
<p>All packages are archived following a consistent naming scheme:</p>
<ol type="1">
<li><p>GHC packages:<br /><code>halcyon-ghc-</code><em><code>version</code></em><code>.tar.xz</code></p></li>
<li><p>Cabal packages:</p>
<ul>
<li><p>Non-updated Cabal packages:<br /><code>halcyon-cabal-</code><em><code>version</code></em><code>.tar.xz</code></p></li>
<li><p>Updated Cabal packages:<br /><code>halcyon-cabal-</code><em><code>version</code></em><code>-</code><em><code>timestamp</code></em><code>.tar.xz</code></p></li>
</ul></li>
<li><p>Sandbox packages:<br /><code>halcyon-sandbox-</code><em><code>ghc_version</code></em><code>-</code><em><code>app_name</code></em><code>-</code><em><code>app_version</code></em><code>-</code><em><code>digest</code></em><code>.tar.gz</code></p>
<p>Sandbox configuration files are also stored separately:<br /><code>halcyon-sandbox-</code><em><code>ghc_version</code></em><code>-</code><em><code>app_name</code></em><code>-</code><em><code>app_version</code></em><code>-</code><em><code>digest</code></em><code>.cabal.config</code></p></li>
<li><p>App packages:<br /><code>halcyon-app-</code><em><code>ghc_version</code></em><code>-</code><em><code>app-name</code></em><code>-</code><em><code>app_version</code></em><code>.tar.gz</code></p></li>
</ol>
</section>
<section id="rationale" class="level3">
<h3>Rationale</h3>
<p>Separating the dependencies required to compile any app into four types is an attempt at striking a balance between the time spent compiling and the space occupied by compilation products. This design allows for mixing-and-matching GHC and Cabal versions, updating the Cabal database incrementally or from scratch, and extending sandboxes based on existing sandboxes.</p>
<p>Each type of package is expected to vary at a different rate—from never-changing GHC packages, to app packages which change on every deployment.</p>
</section>
</section>
<section id="s3-buckets" class="level2">
<h2>S3 buckets</h2>
<p><em>Haskell on Heroku</em> is intended to be used with a private Amazon S3 bucket, defined by the <a href="documentation/reference/#halcyon_s3_bucket"><code>HALCYON_S3_BUCKET</code></a> configuration variable.</p>
<p>All packages required to compile an app are downloaded from the bucket. If any required packages are not found, compilation will not succeed, and an app-less slug will be deployed. This allows prebuilding packages on an one-off dyno.</p>
<p>Any prebuilt packages are archived and uploaded to the bucket. All uploaded files are assigned an <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/S3_ACLs_UsingACLs.html">S3 ACL</a>, defined by <a href="documentation/reference/#halcyon_s3_acl"><code>HALCYON_S3_ACL</code></a>, which defaults to <code>private</code>.</p>
<p>Access to the bucket is controlled by setting <a href="documentation/reference/#halcyon_aws_access_key"><code>HALCYON_AWS_ACCESS_KEY_ID</code></a> and <a href="documentation/reference/#halcyon_aws_secret_access_key"><code>HALCYON_AWS_SECRET_ACCESS_KEY</code></a>.</p>
<section id="public-packages" class="level3">
<h3>Public packages</h3>
<p>For the purposes of getting started quickly, it is also possible to use <a href="http://s3.halcyon.sh/">public packages</a>, by not defining a private bucket. This is not recommended for production usage, as the set of available public packages may change at any time.</p>
<p>Additionally, as public packages cannot satisfy all dependencies required to compile every app, some apps will not compile successfully unless a private bucket is defined.</p>
<p>If a private bucket is defined, public packages are never used. This helps maintain complete control over the deployed code.</p>
</section>
<section id="rationale-1" class="level3">
<h3>Rationale</h3>
<p>A private bucket is necessary because of the separation between the dynos used for compiling apps and the one-off dynos used for prebuilding packages.</p>
<p>Compile dynos keep packages in the Heroku compile cache, but prebuild dynos are not allowed to access the cache. Some form of external storage must be used to transfer the packages between dynos, and an Amazon S3 bucket is a good solution to this problem.</p>
<p>While <em>Haskell on Heroku</em> is designed to make prebuilding packages on one-off dynos as easy as possible, packages can also be prebuilt on any machine with a compatible architecture and OS. Please refer to the <a href="http://halcyon.sh/documentation/"><em>Halcyon</em> documentation</a> for details.</p>
<p>Storing packages externally also allows unrelated apps to share common dependencies. Sharing the same private bucket between multiple apps requires no additional configuration beyond defining the same bucket for every app. This is how public packages are made available.</p>
</section>
</section>
<section id="caching" class="level2">
<h2>Caching</h2>
<p><em>Haskell on Heroku</em> downloads all files to the Heroku compile cache, which is automatically cleaned after every installation, retaining only the most recently used packages.</p>
<p>Deleting the contents of the cache before installation can be requested by setting the <a href="documentation/reference/#halcyon_purge_cache"><code>HALCYON_PURGE_CACHE</code></a> configuration variable to <code>1</code>. This is equivalent to using the <a href="https://github.com/heroku/heroku-repo#purge_cache"><code>purge_cache</code></a> command from the <a href="https://github.com/heroku/heroku-repo/"><code>heroku-repo</code></a> plugin, but more efficient.</p>
<p>Remember to unset the variable before redeploying.</p>
<hr />
<p><em>To be continued.</em></p>
</section>
</section>
</div>
</main>
<footer id="bottom">
<div class="wrapper">
<nav id="footer-menu-bar" class="menu-bar">
<h1 class="logotype"><a href="." title="Haskell on Heroku">Haskell on Heroku</a></h1>
<span id="footer-button"><a href="#top" title="Top">Top</a></span>
<ul id="footer-menu" class="menu open">
<li><a class="link-about" href="about/">About</a></li> <li><a class="link-documentation" href="documentation/">Documentation</a></li> <li><a href="https://github.com/mietek/haskell-on-heroku/">GitHub</a></li>
</ul>
</nav>
<aside> <p> Made by <a href="http://mietek.io/">Miëtek Bak</a>. Supported by <a href="http://leastfixed.com/">Least Fixed</a>. Published under the <a href="license/">MIT X11 License</a>. Not affiliated with <a href="http://heroku.com/">Heroku</a>. </p> </aside>

</div>
</footer>
<!--[if lte IE 9]>
<div id="what-browser">
<div class="wrapper">
<aside>
<p>Please update your browser. “<a href="http://whatbrowser.org/" title="Find out!">What browser?</a>”</p>
</aside>
</div>
</div>
<![endif]-->
<script async src="_scripts.js.gz"></script>
</body>
</html>
